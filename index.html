<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ‚Ø±ÙŠØ± Ø²ÙŠØ§Ø±Ø© Ù…Ø¯Ø±Ø³ÙŠØ©</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles to use the Cairo font */
        body {
            font-family: 'Cairo', sans-serif;
        }
        @media print {
            .no-print { display: none !important; }
            body * {
                visibility: hidden;
            }
            #reportPreviewContainer, #reportPreviewContainer * {
                visibility: visible;
            }
            #reportPreviewContainer {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: none;
            }
        }
        .modal-backdrop {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Dashboard View -->
    <div id="dashboardView" class="container mx-auto max-w-4xl p-6 md:p-8 my-10 bg-white rounded-2xl shadow-lg">
        <header class="flex justify-between items-center mb-8 border-b pb-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h1>
                <p class="text-gray-500 mt-2">Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</p>
            </div>
            <button id="addNewReportBtn" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-6 py-3 whitespace-nowrap transition-colors">
                + ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯
            </button>
        </header>
        <div id="reportsListContainer">
            <!-- Reports list will be dynamically populated here -->
        </div>
    </div>


    <!-- Form View -->
    <div id="formView" class="container mx-auto max-w-4xl p-6 md:p-8 my-10 bg-white rounded-2xl shadow-lg hidden no-print">
        <header class="text-center mb-8">
            <h1 id="formTitle" class="text-3xl font-bold text-gray-800">Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø²ÙŠØ§Ø±Ø© Ø¥Ø´Ø±Ø§ÙÙŠØ©</h1>
            <p class="text-gray-500 mt-2">Ù†Ù…ÙˆØ°Ø¬ Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø´Ø±Ø§ÙÙŠØ© Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†</p>
        </header>

        <form id="reportForm" class="space-y-8">
             <input type="hidden" id="reportId" value="">

            <!-- School and Date Section -->
            <fieldset class="border p-6 rounded-lg bg-gray-50/50">
                <legend class="text-lg font-semibold text-gray-700 px-2">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
                    <div>
                        <label for="schoolName" class="block mb-2 text-sm font-medium text-gray-900">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</label>
                        <select id="schoolName" name="schoolName" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
                            <option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</option>
                            <option value="Ø£Ø¨Ùˆ Ø§Ù„Ù‚Ø§Ø³Ù… Ø§Ù„Ø²Ù‡Ø±Ø§ÙˆÙŠ">Ø£Ø¨Ùˆ Ø§Ù„Ù‚Ø§Ø³Ù… Ø§Ù„Ø²Ù‡Ø±Ø§ÙˆÙŠ</option>
                            <option value="Ø£Ø¨Ùˆ Ø£ÙŠÙˆØ¨ Ø§Ù„Ø­Ø¶Ø±Ù…ÙŠ">Ø£Ø¨Ùˆ Ø£ÙŠÙˆØ¨ Ø§Ù„Ø­Ø¶Ø±Ù…ÙŠ</option>
                            <option value="Ø£Ø¨Ùˆ ØªÙ…Ø§Ù…">Ø£Ø¨Ùˆ ØªÙ…Ø§Ù…</option>
                            <option value="Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø§Ù„Ù†Ø¹Ù…Ø§Ù†">Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø§Ù„Ù†Ø¹Ù…Ø§Ù†</option>
                            <option value="Ø§Ù„Ø´ÙŠØ® Ø³Ø§Ù„Ù… Ø§Ù„Ø³ÙŠØ§Ø¨ÙŠ">Ø§Ù„Ø´ÙŠØ® Ø³Ø§Ù„Ù… Ø§Ù„Ø³ÙŠØ§Ø¨ÙŠ</option>
                            <option value="Ø§Ù„Ø´ÙŠØ® Ø³Ø¹ÙŠØ¯ Ø§Ù„ÙƒÙ†Ø¯ÙŠ Ù…Ø³Ø§Ø¦ÙŠ">Ø§Ù„Ø´ÙŠØ® Ø³Ø¹ÙŠØ¯ Ø§Ù„ÙƒÙ†Ø¯ÙŠ Ù…Ø³Ø§Ø¦ÙŠ</option>
                            <option value="Ø§Ù„Ø´ÙŠØ® Ù†Ø§ØµØ± Ø§Ù„Ø®Ø±ÙˆØµÙŠ">Ø§Ù„Ø´ÙŠØ® Ù†Ø§ØµØ± Ø§Ù„Ø®Ø±ÙˆØµÙŠ</option>
                            <option value="Ø¬Ù†Ø§Ø¯Ø© Ø§Ù„Ø§Ø²Ø¯Ù‰ (Ù…ÙˆØ³Ù‰ Ø³Ø§Ø¨Ù‚Ø§)">Ø¬Ù†Ø§Ø¯Ø© Ø§Ù„Ø§Ø²Ø¯Ù‰ (Ù…ÙˆØ³Ù‰ Ø³Ø§Ø¨Ù‚Ø§)</option>
                            <option value="Ø­ÙØµ Ø¨Ù† Ø±Ø§Ø´Ø¯">Ø­ÙØµ Ø¨Ù† Ø±Ø§Ø´Ø¯</option>
                            <option value="Ø®Ø±ÙŠØ³ Ø§Ù„Ø­Ø¨ÙˆØ³">Ø®Ø±ÙŠØ³ Ø§Ù„Ø­Ø¨ÙˆØ³</option>
                            <option value="Ø³Ù‡ÙŠÙ„ Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠ">Ø³Ù‡ÙŠÙ„ Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠ</option>
                            <option value="ÙƒØ¹Ø¨ Ø¨Ù† Ø²ÙŠØ¯">ÙƒØ¹Ø¨ Ø¨Ù† Ø²ÙŠØ¯</option>
                            <option value="ÙŠØ²ÙŠØ¯ Ø§Ù„Ø·Ø§Ø¦ÙŠ">ÙŠØ²ÙŠØ¯ Ø§Ù„Ø·Ø§Ø¦ÙŠ</option>
                            <option value="Ø§Ø¬ÙŠØ§Ù„ Ø§Ù„Ø«Ù‚Ø§ÙØ©">Ø§Ø¬ÙŠØ§Ù„ Ø§Ù„Ø«Ù‚Ø§ÙØ©</option>
                            <option value="Ø§Ø¬ÙŠØ§Ù„ Ø§Ù„ÙØ±Ø¯ÙˆØ³ - Ø§Ù„Ø­ÙŠÙ„">Ø§Ø¬ÙŠØ§Ù„ Ø§Ù„ÙØ±Ø¯ÙˆØ³ - Ø§Ù„Ø­ÙŠÙ„</option>
                            <option value="Ø§Ù„Ø¨ÙŠØ§Ù†">Ø§Ù„Ø¨ÙŠØ§Ù†</option>
                            <option value="Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¹">Ø§Ù„Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø¯Ø¹</option>
                            <option value="Ø§Ù„Ø±ÙŠØ§Ø¯Ø©">Ø§Ù„Ø±ÙŠØ§Ø¯Ø©</option>
                            <option value="Ø§Ù„ØµÙÙˆØ© Ø§Ù„Ù…Ø¹Ø¨ÙŠÙ„Ø©">Ø§Ù„ØµÙÙˆØ© Ø§Ù„Ù…Ø¹Ø¨ÙŠÙ„Ø©</option>
                            <option value="Ø§Ù„Ù…Ø¬Ø¯">Ø§Ù„Ù…Ø¬Ø¯</option>
                            <option value="Ø§Ù†Ø³ Ø¨Ù† Ù…Ø§Ù„Ùƒ (Ø§Ù„Ù…Ù†Ø§Ø± Ø³Ø§Ø¨Ù‚Ø§)">Ø§Ù†Ø³ Ø¨Ù† Ù…Ø§Ù„Ùƒ (Ø§Ù„Ù…Ù†Ø§Ø± Ø³Ø§Ø¨Ù‚Ø§)</option>
                            <option value="Ø¬ÙŠÙØ± Ø¨Ù† Ø§Ù„Ø¬Ù„Ù†Ø¯ÙŠ">Ø¬ÙŠÙØ± Ø¨Ù† Ø§Ù„Ø¬Ù„Ù†Ø¯ÙŠ</option>
                            <option value="Ø¯Ø±Ø© Ù…Ø¬Ø§Ù†">Ø¯Ø±Ø© Ù…Ø¬Ø§Ù†</option>
                            <option value="Ø¶ÙŠØ§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„">Ø¶ÙŠØ§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</option>
                            <option value="Ù…Ø´Ø§Ø¹Ù„ Ù…Ø³Ù‚Ø· Ø³ÙˆØ± Ø§Ù„Ø­Ø¯ÙŠØ¯">Ù…Ø´Ø§Ø¹Ù„ Ù…Ø³Ù‚Ø· Ø³ÙˆØ± Ø§Ù„Ø­Ø¯ÙŠØ¯</option>
                            <option value="Ù…Ù†Ø§Ø¨Ø¹ Ø§Ù„ØªÙÙˆÙ‚">Ù…Ù†Ø§Ø¨Ø¹ Ø§Ù„ØªÙÙˆÙ‚</option>
                        </select>
                    </div>
                    <div>
                        <label for="visitDate" class="block mb-2 text-sm font-medium text-gray-900">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²ÙŠØ§Ø±Ø©</label>
                        <input type="date" id="visitDate" name="visitDate" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
                    </div>
                </div>
            </fieldset>
            
            <!-- Visit Type Section -->
            <fieldset class="border p-6 rounded-lg bg-gray-50/50">
                <legend class="text-lg font-semibold text-gray-700 px-2">Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</legend>
                <div class="flex items-center gap-4 mt-2">
                    <select id="visitTypeSelect" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                        <!-- Options will be dynamically generated by JS -->
                    </select>
                    <button type="button" id="manageVisitTypesBtn" class="p-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg border hover:bg-gray-200 transition-colors whitespace-nowrap">
                        âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù†ÙˆØ§Ø¹
                    </button>
                </div>
            </fieldset>

            <!-- Visit Objectives Section -->
            <fieldset class="border p-6 rounded-lg bg-gray-50/50">
                <legend class="text-lg font-semibold text-gray-700 px-2">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø²ÙŠØ§Ø±Ø©</legend>
                <div id="objectivesContainer" class="space-y-4 mt-4">
                    <!-- Checkboxes will be dynamically generated by JS -->
                </div>
            </fieldset>

            <!-- Visitor's Opinion Section -->
            <fieldset class="border p-6 rounded-lg bg-gray-50/50">
                <legend class="text-lg font-semibold text-gray-700 px-2">Ø±Ø£ÙŠ Ø§Ù„Ø²Ø§Ø¦Ø±</legend>
                 <p class="text-sm text-gray-500 mb-4">Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù„ÙƒÙ„ Ù‡Ø¯Ù Ù…Ù† Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø£Ø¹Ù„Ø§Ù‡.</p>
                <div id="opinionsContainer" class="space-y-6">
                    <!-- Opinion textareas will be generated here -->
                </div>
            </fieldset>

            <!-- Recommendations Section -->
            <fieldset class="border p-6 rounded-lg bg-gray-50/50">
                <legend class="text-lg font-semibold text-gray-700 px-2">Ø§Ù„ØªÙˆØµÙŠØ§Øª</legend>
                <div class="mt-4">
                    <div class="flex items-center justify-between mb-2 gap-4 flex-wrap">
                        <label for="recommendations" class="block text-sm font-medium text-gray-900 sr-only">Ø§Ù„ØªÙˆØµÙŠØ§Øª</label>
                        <div class="flex gap-4">
                             <button type="button" id="generate-recommendations-btn" class="flex items-center text-sm text-blue-600 font-semibold hover:text-blue-800 transition-colors">
                                ğŸ“‹ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª
                            </button>
                        </div>
                    </div>
                    <textarea id="recommendations" name="recommendations" rows="5" class="block p-2.5 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙˆØµÙŠØ§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ..."></textarea>
                </div>
            </fieldset>

            <!-- Attachments Section -->
            <fieldset class="border p-6 rounded-lg bg-gray-50/50">
                <legend class="text-lg font-semibold text-gray-700 px-2">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</legend>
                <div class="mt-4">
                    <label for="attachmentsInput" class="block mb-2 text-sm font-medium text-gray-900">Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª (ØµÙˆØ±ØŒ Ù…Ø³ØªÙ†Ø¯Ø§Øª...)</label>
                    <input type="file" id="attachmentsInput" multiple class="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none">
                    <div id="attachmentsList" class="mt-4 space-y-2">
                        <!-- Attached files will be listed here -->
                    </div>
                </div>
            </fieldset>
            
            <!-- Action Buttons -->
            <div class="flex justify-end pt-4 gap-4">
                 <button type="button" id="backToDashboardBtn" class="text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 font-medium rounded-lg text-sm w-full sm:w-auto px-8 py-3 text-center transition-colors">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="button" id="prepareReportBtn" class="text-white bg-green-700 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm w-full sm:w-auto px-8 py-3 text-center transition-colors">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-8 py-3 text-center transition-colors">Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
            </div>

        </form>
    </div>

    <!-- Report Preview Section -->
    <div id="reportPreviewContainer" class="container mx-auto max-w-4xl p-6 md:p-8 my-10 bg-white rounded-2xl shadow-lg hidden">
         <div id="reportContent" class="prose max-w-none">
            <!-- Generated report will be injected here -->
         </div>
         <div class="flex justify-end pt-6 mt-6 border-t no-print gap-4 flex-wrap">
            <button id="backToBtn" class="text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 font-medium rounded-lg text-sm px-8 py-3 text-center transition-colors">Ø±Ø¬ÙˆØ¹</button>
            <button onclick="window.print()" class="text-white bg-gray-800 hover:bg-gray-900 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-8 py-3 text-center transition-colors">Ø·Ø¨Ø§Ø¹Ø©</button>
         </div>
    </div>
    
    <!-- Modals (Unchanged) -->
    <div id="manageTypesModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 modal-backdrop">
        <div class="relative top-1/2 -translate-y-1/2 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white modal-content">
            <div class="flex justify-between items-center border-b pb-3">
                 <h3 class="text-lg leading-6 font-medium text-gray-900">Ø¥Ø¯Ø§Ø±Ø© Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</h3>
                 <button id="closeManageModalBtn" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                 </button>
            </div>
            <div class="mt-4">
                <div id="visitTypesList" class="space-y-2 max-h-60 overflow-y-auto pr-2"></div>
                <div class="mt-6 pt-4 border-t">
                    <button id="addNewTypeBtn" class="w-full text-white bg-blue-600 hover:bg-blue-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center">Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯</button>
                </div>
            </div>
        </div>
    </div>
    <div id="addEditTypeModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50 modal-backdrop">
        <div class="relative top-1/2 -translate-y-1/2 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white modal-content">
            <h3 id="addEditModalTitle" class="text-lg leading-6 font-medium text-gray-900 mb-4"></h3>
            <form id="addEditTypeForm">
                <input type="hidden" id="editTypeKey" value="">
                <div>
                    <label for="typeName" class="block mb-2 text-sm font-medium text-gray-900">Ø§Ø³Ù… Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</label>
                    <input type="text" id="typeName" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
                </div>
                <div class="mt-4">
                    <label for="typeObjectives" class="block mb-2 text-sm font-medium text-gray-900">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù (ÙƒÙ„ Ù‡Ø¯Ù ÙÙŠ Ø³Ø·Ø±)</label>
                    <textarea id="typeObjectives" rows="8" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500" required></textarea>
                </div>
                <div class="items-center px-4 py-3 gap-3 flex justify-end mt-4 border-t pt-4">
                    <button id="saveTypeBtn" type="submit" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-green-700">Ø­ÙØ¸</button>
                    <button id="cancelEditBtn" type="button" class="px-4 py-2 bg-gray-200 text-gray-800 text-base font-medium rounded-md w-auto shadow-sm hover:bg-gray-300">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            // --- STORAGE KEYS ---
            const TYPES_STORAGE_KEY = 'visitTypesData';
            const REPORTS_STORAGE_KEY = 'savedReportsData';

            // --- DEFAULT DATA ---
            const defaultVisitTypesData = {
                 'exploratory': {
                    name: 'Ø²ÙŠØ§Ø±Ø© Ø§Ø³ØªØ·Ù„Ø§Ø¹ÙŠØ©',
                    objectives: ["Ù…Ù‚Ø§Ø¨Ù„Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆÙ…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©.","Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù…Ø±Ø§Ø³Ù… Ø±ÙØ¹ Ø§Ù„Ø¹Ù„Ù….","ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.","Ù…ØªØ§Ø¨Ø¹Ø© Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„ØªØ¹ÙŠÙŠÙ†.","Ù…ØªØ§Ø¨Ø¹Ø© ØªÙˆÙØ± Ø§Ù„Ø§Ø¯Ù„Ø© ÙˆÙƒØªØ§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØªØ­Ø¯ÙŠØ«Ù‡Ø§.","Ù…ØªØ§Ø¨Ø¹Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆÙ†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.","Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ ÙˆØªØ®Ø·ÙŠØ·Ù‡Ø§ ÙˆØ§Ù„Ø§Ø¯ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©.","Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù†Ø´Ø±Ø§Øª ÙˆÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… ÙˆÙ…Ù†Ø§Ù‚Ø´Ø© Ù…Ø³ØªØ¬Ø¯Ø§ØªÙ‡Ø§.","Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ù†Ù‡Ø§Ø¬ ÙˆØ³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.","Ø­Ø¶ÙˆØ± Ù…ÙˆÙ‚Ù ØµÙÙŠ Ù…Ø¹ Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ù…Ø¯Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ø´Ø±Ø§ÙÙŠØ©."],
                    completedOpinions: ["ØªÙ…Øª Ù…Ù‚Ø§Ø¨Ù„Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆÙ…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©ØŒ ÙˆØ¬Ø±Ù‰ Ù†Ù‚Ø§Ø´ Ø¨Ù†Ù‘Ø§Ø¡ ÙˆÙ…Ø«Ù…Ø± Ø­ÙˆÙ„ Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©.","ØªÙ… Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù…Ø±Ø§Ø³Ù… Ø±ÙØ¹ Ø§Ù„Ø¹Ù„Ù…ØŒ ÙˆÙƒØ§Ù† Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø© Ù„Ù„Ù†Ø´ÙŠØ¯ Ø§Ù„ÙˆØ·Ù†ÙŠ Ø¨ØµÙˆØª Ø¹Ø§Ù„Ù ÙˆÙ…Ø±Ø§Ø³Ù… Ø±ÙØ¹ Ø§Ù„Ø¹Ù„Ù… ØµØ­ÙŠØ­Ø© ÙˆÙ…Ù†Ø¸Ù…Ø©.","ØªÙ… ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø®ØµØµ ÙˆÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©.","ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ ÙˆÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹Ù‡Ø§ Ù…ÙƒØªÙ…Ù„Ø© ÙˆÙ…ÙˆØ«Ù‚Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£ØµÙˆÙ„.","ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© ØªÙˆÙØ± Ø§Ù„Ø£Ø¯Ù„Ø© ÙˆÙƒØªØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ØŒ ÙˆÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹Ù‡Ø§ Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„Ø·Ø¨Ø¹Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ÙˆÙ…ÙˆØ²Ø¹Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨Ø©.","ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ ÙˆÙ†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†ØŒ ÙˆÙƒØ§Ù† Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ù…ØªÙˆØ§Ø²Ù†Ù‹Ø§ ÙˆØ¹Ø§Ø¯Ù„Ø§Ù‹ ÙˆÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©.","ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ ÙˆØªØ®Ø·ÙŠØ·Ù‡Ø§ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©ØŒ ÙˆÙƒØ§Ù†Øª Ø¨Ø­Ø§Ù„Ø© Ø¬ÙŠØ¯Ø© ÙˆÙ…ØªÙˆÙØ±Ø© ÙˆØªÙ„Ø¨ÙŠ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø©.","ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù†Ø´Ø±Ø§Øª ÙˆÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…ØŒ ÙˆØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø§Ù‚Ø´ØªÙ‡Ø§ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØ¥Ù„Ù…Ø§Ù…Ù‡Ù… Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ¬Ø¯Ø§Øª.","ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ†ÙÙŠØ° Ø®Ø·Ø© Ø§Ù„Ù…Ù†Ù‡Ø§Ø¬ ÙˆØ³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†ØŒ ÙˆÙƒØ§Ù†Øª Ù…ÙƒØªÙ…Ù„Ø© ÙˆÙ…Ù†Ø¸Ù…Ø© ÙˆØªØ¸Ù‡Ø± Ù…ØªØ§Ø¨Ø¹Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨Ø©.","ØªÙ… Ø­Ø¶ÙˆØ± Ù…ÙˆÙ‚Ù ØµÙÙŠ Ù…Ø¹ Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ù…Ø§Ø¯Ø©ØŒ ÙˆÙƒØ§Ù† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù…ØªÙ…ÙŠØ²Ù‹Ø§ ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ ØµÙÙŠÙ‹Ø§ ÙˆÙ†Ø´Ø·Ù‹Ø§ØŒ ØªÙ„ØªÙ‡Ø§ Ù…Ø¯Ø§ÙˆÙ„Ø© Ø¥Ø´Ø±Ø§ÙÙŠØ© Ø¨Ù†Ù‘Ø§Ø¡Ø©."],
                    incompleteOpinions: ["ØªÙ…Øª Ù…Ù‚Ø§Ø¨Ù„Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ÙˆØ¨ØºÙŠØ§Ø¨ Ø¨Ø¹Ø¶ Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ù…Ø§Ø¯Ø©ØŒ ÙˆØ£ÙØ§Ø¯Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ØºÙŠØ§Ø¨ ÙˆØªÙ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.","ØªÙ… Ø­Ø¶ÙˆØ± Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ ÙˆÙ„ÙˆØ­Ø¸ ÙˆØ¬ÙˆØ¯ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙÙŠ Ø§Ù„ØªÙ†Ø¸ÙŠÙ… ÙˆØ±ÙØ¹ Ø§Ù„Ø¹Ù„Ù…ØŒ ÙˆØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡.","Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø¨Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ« Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙˆØªÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·.","ÙŠÙˆØ¬Ø¯ Ù†Ù‚Øµ ÙÙŠ Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†ØŒ ÙˆØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ø§Ø³ØªÙƒÙ…Ø§Ù„Ù‡Ø§ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ø¬Ù„.","Ù„ÙˆØ­Ø¸ ØªØ£Ø®Ø± ÙÙŠ ØªÙˆØ²ÙŠØ¹ Ø¨Ø¹Ø¶ ÙƒØªØ¨ Ø§Ù„Ø·Ù„Ø§Ø¨ØŒ ÙˆØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø«ÙŠØ«Ø© Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¹Ù†ÙŠØ© Ù„Ø¶Ù…Ø§Ù† ÙˆØµÙˆÙ„Ù‡Ø§ Ù„Ù„Ø·Ù„Ø¨Ø©.","Ù„ÙˆØ­Ø¸ ÙˆØ¬ÙˆØ¯ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙÙŠ ØªÙˆØ²ÙŠØ¹ Ù†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµØŒ ÙˆØªÙ…Øª Ù…Ù†Ø§Ù‚Ø´ØªÙ‡Ø§ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø¸Ø± ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø²Ù†.","ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ù„Ø§Ø¹Ø¨ ÙˆÙŠÙˆØ¬Ø¯ Ù†Ù‚Øµ ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ ÙˆØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø¹Ù„Ù… Ù„Ø¹Ù…Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª ÙˆØªØ³Ù„ÙŠÙ…Ù‡Ø§ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.","Ù„ÙˆØ­Ø¸ Ø¹Ø¯Ù… ØªØ¹Ù…ÙŠÙ… Ø¨Ø¹Ø¶ Ø§Ù„Ù†Ø´Ø±Ø§Øª ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†ØŒ ÙˆØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø¶Ø±ÙˆØ±Ø© Ù…Ù†Ø§Ù‚Ø´ØªÙ‡Ø§ ÙˆØªÙˆØ«ÙŠÙ‚ Ø°Ù„Ùƒ.","ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆÙ„ÙˆØ­Ø¸ Ø¹Ø¯Ù… Ø§ÙƒØªÙ…Ø§Ù„ Ø¨Ø¹Ø¶Ù‡Ø§ØŒ ÙˆØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø¶Ø±ÙˆØ±Ø© Ø§Ø³ØªÙƒÙ…Ø§Ù„Ù‡Ø§ ÙˆØªÙˆØ«ÙŠÙ‚ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø© Ø¨Ø´ÙƒÙ„ Ø¯ÙˆØ±ÙŠ.","ØªÙ… Ø­Ø¶ÙˆØ± Ù…ÙˆÙ‚Ù ØµÙÙŠ ÙˆÙ„ÙˆØ­Ø¸ ÙˆØ¬ÙˆØ¯ Ø¨Ø¹Ø¶ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø³ÙŠÙ†ØŒ ÙˆØªÙ…Øª Ù…Ù†Ø§Ù‚Ø´ØªÙ‡Ø§ Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø¯Ø§ÙˆÙ„Ø© Ø§Ù„Ø¥Ø´Ø±Ø§ÙÙŠØ© ÙˆØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ù„Ù…Ø¹Ù„Ù…."],
                    recommendations: ["Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨Ø§Ø¨ ØºÙŠØ§Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† ÙˆØªÙˆÙÙŠØ± Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ….","ØªÙƒØ«ÙŠÙ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø¹Ù„Ù‰ Ù…Ø±Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø§Ù„ØµØ¨Ø§Ø­ÙŠ Ù„Ø¶Ù…Ø§Ù† ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.","Ø¶Ø±ÙˆØ±Ø© Ø§Ø³ØªÙƒÙ…Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø¨Ø´ÙƒÙ„ ÙÙˆØ±ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©.","Ø¶Ø±ÙˆØ±Ø© Ø§Ù„Ø¥Ø³Ø±Ø§Ø¹ ÙÙŠ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù„Ø¶Ù…Ø§Ù† Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³ÙŠØ©.","Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø¹Ø§Ø¬Ù„ Ù…Ø¹ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø¹Ù†ÙŠØ© Ù„Ø¶Ù…Ø§Ù† ØªÙˆÙÙŠØ± ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨.","Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø¸Ø± ÙÙŠ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø²Ù† ÙÙŠ Ù†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.","ØªÙˆÙÙŠØ± Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ù„Ù†Ø§Ù‚ØµØ© Ø­Ø³Ø¨ Ø§Ù„ÙƒØ´Ù Ø§Ù„Ù…ÙØ¹Ø¯ Ù…Ù† Ù…Ø¹Ù„Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ø¬Ù„.","Ø¶Ø±ÙˆØ±Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ ØªØ¹Ù…ÙŠÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ø´Ø±Ø§Øª ÙˆØ§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³ÙŠØ© ÙˆØªÙˆØ«ÙŠÙ‚ Ø°Ù„Ùƒ.","Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† (Ø§Ù„Ø²ÙŠ+Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©+Ø§Ù„ØªØ­Ø¶ÙŠØ±) ÙˆØ§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø£Ù‡Ù…ÙŠØªÙ‡Ø§.","ØªÙ†Ø¸ÙŠÙ… ÙˆØ±Ø´ Ø¹Ù…Ù„ Ø¯Ø§Ø®Ù„ÙŠØ© Ù„ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØµÙÙŠ."]
                }
            };

            // --- STATE VARIABLES ---
            let visitTypesData = {};
            let savedReports = [];
            let currentAttachments = [];
            let currentVisitTypeKey = '';
            let previewSource = 'form'; // 'form' or 'dashboard'

            // --- MAIN VIEWS ---
            const dashboardView = document.getElementById('dashboardView');
            const formView = document.getElementById('formView');
            const reportPreviewContainer = document.getElementById('reportPreviewContainer');
            
            // --- FORM ELEMENTS ---
            const reportForm = document.getElementById('reportForm');
            const reportIdInput = document.getElementById('reportId');
            const formTitle = document.getElementById('formTitle');
            const schoolNameSelect = document.getElementById('schoolName');
            const visitTypeSelect = document.getElementById('visitTypeSelect');
            const objectivesContainer = document.getElementById('objectivesContainer');
            const opinionsContainer = document.getElementById('opinionsContainer');
            const recommendationsTextarea = document.getElementById('recommendations');
            const attachmentsInput = document.getElementById('attachmentsInput');
            const attachmentsList = document.getElementById('attachmentsList');

            
            // --- BUTTONS ---
            const addNewReportBtn = document.getElementById('addNewReportBtn');
            const backToDashboardBtn = document.getElementById('backToDashboardBtn');
            const prepareReportBtn = document.getElementById('prepareReportBtn');
            const backToBtn = document.getElementById('backToBtn');

            // --- DASHBOARD ELEMENTS ---
            const reportsListContainer = document.getElementById('reportsListContainer');
            
            // --- MODAL ELEMENTS (as before) ---
            const manageVisitTypesBtn = document.getElementById('manageVisitTypesBtn');
            const manageTypesModal = document.getElementById('manageTypesModal');
            const closeManageModalBtn = document.getElementById('closeManageModalBtn');
            const visitTypesList = document.getElementById('visitTypesList');
            const addNewTypeBtn = document.getElementById('addNewTypeBtn');
            const addEditTypeModal = document.getElementById('addEditTypeModal');
            const addEditModalTitle = document.getElementById('addEditModalTitle');
            const addEditTypeForm = document.getElementById('addEditTypeForm');
            const editTypeKey = document.getElementById('editTypeKey');
            const typeName = document.getElementById('typeName');
            const typeObjectives = document.getElementById('typeObjectives');
            const saveTypeBtn = document.getElementById('saveTypeBtn');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            const generateRecsBtn = document.getElementById('generate-recommendations-btn');


            // --- DATA MANAGEMENT ---
            function saveVisitTypes() { localStorage.setItem(TYPES_STORAGE_KEY, JSON.stringify(visitTypesData)); }
            function saveReports() { localStorage.setItem(REPORTS_STORAGE_KEY, JSON.stringify(savedReports)); }

            function loadData() {
                const storedTypes = localStorage.getItem(TYPES_STORAGE_KEY);
                visitTypesData = storedTypes ? JSON.parse(storedTypes) : defaultVisitTypesData;
                
                const storedReports = localStorage.getItem(REPORTS_STORAGE_KEY);
                savedReports = storedReports ? JSON.parse(storedReports) : [];
                
                const keys = Object.keys(visitTypesData);
                currentVisitTypeKey = keys.length > 0 ? keys[0] : '';
            }
            
            function generateOpinionsAndRecommendations(objectives) {
                const completedOpinions = objectives.map(obj => `ØªÙ…Øª ${obj.replace(/\.$/, '')} Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙƒØ§Ù†Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©.`);
                const incompleteOpinions = objectives.map(obj => `Ù„ÙˆØ­Ø¸ ÙˆØ¬ÙˆØ¯ Ù‚ØµÙˆØ± ÙÙŠ ${obj.replace(/\.$/, '')}ØŒ ÙˆØªÙ… ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠÙ† Ù„Ø§ØªØ®Ø§Ø° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©.`);
                const recommendations = objectives.map(obj => `Ù…ØªØ§Ø¨Ø¹Ø© ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚ØµÙˆØ± Ø§Ù„Ù…ØªØ¹Ù„Ù‚ Ø¨Ù€ "${obj.replace(/\.$/, '')}".`);
                return { completedOpinions, incompleteOpinions, recommendations };
            }

            // --- VIEW MANAGEMENT ---
            function showDashboardView() {
                renderDashboard();
                dashboardView.classList.remove('hidden');
                formView.classList.add('hidden');
                reportPreviewContainer.classList.add('hidden');
            }

            function showFormView(reportId = null) {
                formView.classList.remove('hidden');
                dashboardView.classList.add('hidden');
                reportPreviewContainer.classList.add('hidden');
                if (reportId) {
                    const report = savedReports.find(r => r.id === reportId);
                    if (report) {
                        populateForm(report);
                        formTitle.textContent = 'ØªØ¹Ø¯ÙŠÙ„ ØªÙ‚Ø±ÙŠØ± Ø²ÙŠØ§Ø±Ø©';
                    }
                } else {
                    resetForm();
                    formTitle.textContent = 'Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø²ÙŠØ§Ø±Ø© Ø¥Ø´Ø±Ø§ÙÙŠØ©';
                }
            }

            function showPreviewView(reportData) {
                renderReportPreview(reportData);
                reportPreviewContainer.classList.remove('hidden');
                dashboardView.classList.add('hidden');
                formView.classList.add('hidden');
            }

            // --- DASHBOARD RENDERING ---
            function renderDashboard() {
                reportsListContainer.innerHTML = '';
                if (savedReports.length === 0) {
                    reportsListContainer.innerHTML = `<div class="text-center py-10 px-6 bg-gray-50 rounded-lg">
                        <h3 class="text-lg font-semibold text-gray-700">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</h3>
                        <p class="text-gray-500 mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ±Ùƒ Ø§Ù„Ø£ÙˆÙ„ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "+ ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯".</p>
                    </div>`;
                    return;
                }

                const list = document.createElement('div');
                list.className = 'space-y-4';
                savedReports.sort((a, b) => new Date(b.visitDate) - new Date(a.visitDate)).forEach(report => {
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-4 bg-white border rounded-lg shadow-sm hover:shadow-md transition-shadow';
                    const reportDate = new Date(report.visitDate).toLocaleDateString('ar-OM', { year: 'numeric', month: 'long', day: 'numeric' });
                    const attachmentIcon = (report.attachments && report.attachments.length > 0) ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-400 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a3 3 0 00-3 3v4a3 3 0 006 0V7a1 1 0 112 0v4a5 5 0 01-10 0V7a5 5 0 0110 0v4a1 1 0 11-2 0V7a3 3 0 00-3-3z" clip-rule="evenodd" /></svg>` : '';
                    item.innerHTML = `
                        <div class="flex items-center">
                            ${attachmentIcon}
                            <div>
                                <p class="font-bold text-gray-800">${report.schoolName}</p>
                                <p class="text-sm text-gray-500">${reportDate} - ${report.visitTypeName}</p>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <button data-id="${report.id}" class="view-btn text-sm text-green-600 hover:underline">Ø¹Ø±Ø¶</button>
                            <button data-id="${report.id}" class="edit-btn text-sm text-blue-600 hover:underline">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button data-id="${report.id}" class="delete-btn text-sm text-red-600 hover:underline">Ø­Ø°Ù</button>
                        </div>
                    `;
                    list.appendChild(item);
                });
                reportsListContainer.appendChild(list);
            }

            // --- FORM MANAGEMENT ---
            function resetForm() {
                reportForm.reset();
                reportIdInput.value = '';
                document.getElementById('visitDate').valueAsDate = new Date();
                currentVisitTypeKey = Object.keys(visitTypesData)[0] || '';
                visitTypeSelect.value = currentVisitTypeKey;
                currentAttachments = [];
                renderAttachmentsList();
                renderObjectivesForCurrentType();
            }
            
            function populateForm(report) {
                resetForm();
                reportIdInput.value = report.id;
                document.getElementById('schoolName').value = report.schoolName;
                document.getElementById('visitDate').value = report.visitDate;
                recommendationsTextarea.value = report.recommendations;
                
                currentVisitTypeKey = report.visitTypeKey;
                visitTypeSelect.value = currentVisitTypeKey;
                currentAttachments = report.attachments || [];
                renderAttachmentsList();
                renderObjectivesForCurrentType();

                // Check objectives and fill opinions
                const checkboxes = objectivesContainer.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => {
                    const index = cb.dataset.index;
                    if (report.checkedObjectives.includes(cb.value)) {
                        cb.checked = true;
                    }
                });
                updateOpinionsSection();
                report.opinions.forEach(op => {
                    const textarea = document.getElementById(`opinion-${op.index}`);
                    if (textarea) textarea.value = op.text;
                });
            }

            function populateVisitTypeDropdown() {
                visitTypeSelect.innerHTML = '';
                Object.keys(visitTypesData).forEach(key => {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = visitTypesData[key].name;
                    visitTypeSelect.appendChild(option);
                });
                if (currentVisitTypeKey) {
                    visitTypeSelect.value = currentVisitTypeKey;
                }
            }
            
            function renderObjectivesForCurrentType() {
                if (!currentVisitTypeKey || !visitTypesData[currentVisitTypeKey]) return;
                const data = visitTypesData[currentVisitTypeKey];
                objectivesContainer.innerHTML = '';
                data.objectives.forEach((objective, index) => {
                    objectivesContainer.innerHTML += `
                        <div class="flex items-start">
                            <input id="objective-${index}" type="checkbox" value="${objective}" data-index="${index}" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 mt-1">
                            <label for="objective-${index}" class="mr-2 text-sm font-medium text-gray-900">${objective}</label>
                        </div>`;
                });
                updateOpinionsSection();
            }

            function updateOpinionsSection() {
                const previouslySavedOpinions = new Map();
                opinionsContainer.querySelectorAll('.opinion-block textarea').forEach(textarea => {
                    previouslySavedOpinions.set(textarea.id, textarea.value);
                });

                opinionsContainer.innerHTML = '';
                const checkedCheckboxes = objectivesContainer.querySelectorAll('input[type="checkbox"]:checked');
                
                if (checkedCheckboxes.length === 0) {
                    opinionsContainer.innerHTML = '<p class="text-center text-gray-500">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ù‡Ø¯Ù Ø¨Ø¹Ø¯.</p>';
                    return;
                }
                
                checkedCheckboxes.forEach(checkbox => {
                    const index = checkbox.dataset.index;
                    const objectiveText = checkbox.value;
                    const opinionId = `opinion-${index}`;
                    
                    const opinionBlock = document.createElement('div');
                    opinionBlock.className = 'opinion-block space-y-2';

                    let specialInputsHTML = '';
                    const classSessionObjectiveText = "Ø­Ø¶ÙˆØ± Ù…ÙˆÙ‚Ù ØµÙÙŠ Ù…Ø¹ Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ù…Ø¯Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ø´Ø±Ø§ÙÙŠØ©.";
                    const timetableObjectiveText = "Ù…ØªØ§Ø¨Ø¹Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆÙ†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.";

                    if (objectiveText === classSessionObjectiveText) {
                         specialInputsHTML = `
                            <div class="p-3 bg-gray-100 rounded-md border space-y-3">
                                <div id="session-rows-container-${index}" class="space-y-2">
                                    <!-- Initial row -->
                                    <div class="grid grid-cols-4 gap-2 items-center session-row">
                                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md lesson-number-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­ØµØ©">
                                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md teacher-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…">
                                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md class-name-input" placeholder="Ø§Ù„ØµÙ/Ø§Ù„Ø´Ø¹Ø¨Ø©">
                                        <span></span> <!-- Placeholder for alignment -->
                                    </div>
                                </div>
                                <button type="button" data-index="${index}" class="add-session-btn text-sm text-blue-600 hover:underline">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ù ØµÙÙŠ</button>
                            </div>
                        `;
                    } else if (objectiveText === timetableObjectiveText) {
                         specialInputsHTML = `
                            <div class="p-3 bg-gray-100 rounded-md border space-y-3">
                                <div id="teacher-rows-container-${index}" class="space-y-2">
                                    <!-- Initial row -->
                                    <div class="grid grid-cols-4 gap-2 items-center teacher-timetable-row">
                                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md teacher-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…">
                                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md teacher-load-input" placeholder="Ù†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµ">
                                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md teacher-classes-input" placeholder="Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªÙŠ ÙŠØ¯Ø±Ø³Ù‡Ø§">
                                        <span></span> <!-- Placeholder for alignment -->
                                    </div>
                                </div>
                                <button type="button" data-index="${index}" class="add-teacher-btn text-sm text-blue-600 hover:underline">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù…</button>
                            </div>
                        `;
                    }

                    opinionBlock.innerHTML = `
                        <label for="${opinionId}" class="block text-sm font-semibold text-gray-800">${opinionsContainer.children.length + 1}- ${objectiveText}</label>
                        ${specialInputsHTML}
                        <div class="flex gap-2">
                            <button type="button" data-objective-text="${objectiveText}" data-opinion="completed" data-index="${index}" class="px-3 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full hover:bg-green-200 transition-colors">âœ… Ù…ÙƒØªÙ…Ù„</button>
                            <button type="button" data-objective-text="${objectiveText}" data-opinion="incomplete" data-index="${index}" class="px-3 py-1 text-xs font-medium text-red-800 bg-red-100 rounded-full hover:bg-red-200 transition-colors">âŒ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„</button>
                        </div>
                        <textarea id="${opinionId}" name="${opinionId}" rows="3" class="block p-2.5 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="..."></textarea>
                    `;

                    opinionsContainer.appendChild(opinionBlock);
                });
                
                // Restore previously written opinions if any
                previouslySavedOpinions.forEach((value, id) => {
                    const textarea = document.getElementById(id);
                    if (textarea) textarea.value = value;
                });
            }

            // --- ATTACHMENTS HANDLING ---
            function renderAttachmentsList() {
                attachmentsList.innerHTML = '';
                if (currentAttachments.length === 0) return;

                currentAttachments.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-2 bg-gray-100 rounded-md text-sm';
                    item.innerHTML = `
                        <span class="text-gray-700 truncate">${file.name}</span>
                        <button type="button" data-index="${index}" class="remove-attachment-btn text-red-500 hover:text-red-700">&times;</button>
                    `;
                    attachmentsList.appendChild(item);
                });
            }

            attachmentsInput.addEventListener('change', (e) => {
                const files = e.target.files;
                if (!files) return;

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        currentAttachments.push({
                            name: file.name,
                            data: event.target.result
                        });
                        renderAttachmentsList();
                    };
                    reader.readAsDataURL(file);
                }
                e.target.value = '';
            });

            attachmentsList.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-attachment-btn')) {
                    const index = parseInt(e.target.dataset.index, 10);
                    currentAttachments.splice(index, 1);
                    renderAttachmentsList();
                }
            });


            // --- REPORT PREVIEW ---
            function renderReportPreview(data) {
                const reportContent = document.getElementById('reportContent');
                const visitDate = new Date(data.visitDate).toLocaleDateString('ar-OM');
                let reportHTML = `<h2 class="text-2xl font-bold mb-4 text-center">ØªÙ‚Ø±ÙŠØ± Ø²ÙŠØ§Ø±Ø© Ø¥Ø´Ø±Ø§ÙÙŠØ©</h2>`;
                reportHTML += `<div class="grid grid-cols-2 gap-4 mb-6 border-b pb-4">
                                <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©:</strong> ${data.schoolName}</p>
                                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²ÙŠØ§Ø±Ø©:</strong> ${visitDate}</p>
                                <p class="col-span-2"><strong>Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø©:</strong> ${data.visitTypeName}</p>
                               </div>`;
                
                let objectivesSection = `<h3 class="text-xl font-semibold mt-6 mb-3">Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø²ÙŠØ§Ø±Ø©:</h3><ul class="list-decimal list-inside space-y-2">`;
                data.checkedObjectives.forEach(obj => { objectivesSection += `<li>${obj}</li>`; });
                reportHTML += objectivesSection + '</ul>';
                
                let opinionsSection = `<h3 class="text-xl font-semibold mt-6 mb-3">Ø±Ø£ÙŠ Ø§Ù„Ø²Ø§Ø¦Ø±:</h3><ol class="list-decimal list-inside space-y-2">`;
                data.opinions.forEach(op => { opinionsSection += `<li class="text-gray-700">${op.text.replace(/\n/g, '<br>')}</li>`; });
                reportHTML += opinionsSection + '</ol>';

                if(data.recommendations) {
                    reportHTML += `<h3 class="text-xl font-semibold mt-6 mb-3">Ø§Ù„ØªÙˆØµÙŠØ§Øª:</h3><p class="text-gray-700">${data.recommendations.replace(/\n/g, '<br>')}</p>`;
                }

                if(data.attachments && data.attachments.length > 0) {
                     reportHTML += `<h3 class="text-xl font-semibold mt-6 mb-3">Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª:</h3><ul class="list-disc list-inside space-y-1">`;
                     data.attachments.forEach(file => {
                         reportHTML += `<li class="text-gray-700">${file.name}</li>`;
                     });
                     reportHTML += `</ul>`;
                }
                
                reportContent.innerHTML = reportHTML;
            }

            // --- EVENT LISTENERS ---
            addNewReportBtn.addEventListener('click', () => showFormView());
            backToDashboardBtn.addEventListener('click', showDashboardView);
            
            reportForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const reportId = reportIdInput.value;
                const checkedObjectives = Array.from(objectivesContainer.querySelectorAll('input:checked')).map(cb => cb.value);
                const opinions = Array.from(objectivesContainer.querySelectorAll('input:checked')).map(cb => {
                    const index = cb.dataset.index;
                    return { index: index, text: document.getElementById(`opinion-${index}`).value };
                });

                const reportData = {
                    id: reportId ? reportId : `report_${Date.now()}`,
                    schoolName: document.getElementById('schoolName').value,
                    visitDate: document.getElementById('visitDate').value,
                    visitTypeKey: currentVisitTypeKey,
                    visitTypeName: visitTypesData[currentVisitTypeKey].name,
                    checkedObjectives: checkedObjectives,
                    opinions: opinions,
                    recommendations: recommendationsTextarea.value,
                    attachments: currentAttachments // Add attachments
                };

                if (reportId) { // Update existing report
                    const index = savedReports.findIndex(r => r.id === reportId);
                    savedReports[index] = reportData;
                } else { // Add new report
                    savedReports.push(reportData);
                }
                saveReports();
                showDashboardView();
            });
            
            prepareReportBtn.addEventListener('click', function() {
                if (!reportForm.checkValidity()) {
                    reportForm.reportValidity();
                    return;
                }
                previewSource = 'form';
                const checkedObjectives = Array.from(objectivesContainer.querySelectorAll('input:checked')).map(cb => cb.value);
                const opinions = Array.from(objectivesContainer.querySelectorAll('input:checked')).map(cb => {
                    const index = cb.dataset.index;
                    return { index: index, text: document.getElementById(`opinion-${index}`).value };
                });
                const reportData = {
                    schoolName: document.getElementById('schoolName').value,
                    visitDate: document.getElementById('visitDate').value,
                    visitTypeName: visitTypesData[currentVisitTypeKey].name,
                    checkedObjectives: checkedObjectives,
                    opinions: opinions,
                    recommendations: recommendationsTextarea.value,
                    attachments: currentAttachments // Add attachments for preview
                };
                showPreviewView(reportData);
            });

            backToBtn.addEventListener('click', () => {
                if (previewSource === 'dashboard') {
                    showDashboardView();
                } else {
                    showFormView(reportIdInput.value || null);
                }
            });

            reportsListContainer.addEventListener('click', (e) => {
                const target = e.target;
                const reportId = target.dataset.id;
                if (!reportId) return;

                if (target.classList.contains('view-btn')) {
                    previewSource = 'dashboard';
                    const report = savedReports.find(r => r.id === reportId);
                    showPreviewView(report);
                }
                if (target.classList.contains('edit-btn')) {
                    showFormView(reportId);
                }
                if (target.classList.contains('delete-btn')) {
                    const report = savedReports.find(r => r.id === reportId);
                    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØªÙ‚Ø±ÙŠØ± Ù…Ø¯Ø±Ø³Ø© "${report.schoolName}"ØŸ`)) {
                        savedReports = savedReports.filter(r => r.id !== reportId);
                        saveReports();
                        renderDashboard();
                    }
                }
            });
            
            schoolNameSelect.addEventListener('change', updateOpinionsSection);
            visitTypeSelect.addEventListener('change', (e) => {
                currentVisitTypeKey = e.target.value;
                renderObjectivesForCurrentType();
            });

            objectivesContainer.addEventListener('change', updateOpinionsSection);

            opinionsContainer.addEventListener('click', (e) => {
                if(e.target.matches('button[data-opinion]')) {
                    const opinionType = e.target.dataset.opinion;
                    const index = e.target.dataset.index;
                    const objectiveText = e.target.dataset.objectiveText;
                    const opinionBlock = e.target.closest('.opinion-block');
                    const textarea = opinionBlock.querySelector('textarea');
                    
                    const classSessionObjectiveText = "Ø­Ø¶ÙˆØ± Ù…ÙˆÙ‚Ù ØµÙÙŠ Ù…Ø¹ Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ù…Ø¯Ø§ÙˆÙ„Ø© Ø§Ù„Ø§Ø´Ø±Ø§ÙÙŠØ©.";
                    const timetableObjectiveText = "Ù…ØªØ§Ø¨Ø¹Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆÙ†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†.";

                    if (opinionType === 'completed' && objectiveText === classSessionObjectiveText) {
                        let summary = "ØªÙ… Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ÙˆØ§Ù‚Ù Ø§Ù„ØµÙÙŠØ© Ø§Ù„ØªØ§Ù„ÙŠØ©:\n";
                        const sessionRows = opinionBlock.querySelectorAll('.session-row');
                        let detailsFound = false;
                        sessionRows.forEach(row => {
                            const lessonNumber = row.querySelector('.lesson-number-input').value;
                            const teacherName = row.querySelector('.teacher-name-input').value;
                            const className = row.querySelector('.class-name-input').value;
                            if (lessonNumber || teacherName || className) {
                                detailsFound = true;
                                summary += `- Ø§Ù„Ø­ØµØ© ${lessonNumber || '(ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©)'} Ù…Ø¹ Ø§.${teacherName || '(ØºÙŠØ± Ù…Ø­Ø¯Ø¯)'} Ù„Ù„ØµÙ ${className || '(ØºÙŠØ± Ù…Ø­Ø¯Ø¯)'}.\n`;
                            }
                        });

                        if (detailsFound) {
                            summary += "ÙˆÙƒØ§Ù† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù… Ù…ØªÙ…ÙŠØ²Ù‹Ø§ØŒ ØªÙ„ØªÙ‡Ø§ Ù…Ø¯Ø§ÙˆÙ„Ø§Øª Ø¥Ø´Ø±Ø§ÙÙŠØ© Ø¨Ù†Ù‘Ø§Ø¡Ø©.";
                            textarea.value = summary;
                        } else {
                            textarea.value = `ØªÙ… Ø­Ø¶ÙˆØ± Ù…ÙˆÙ‚Ù ØµÙÙŠ Ù…Ø¹ Ù…Ø¹Ù„Ù…ÙŠ Ø§Ù„Ù…Ø§Ø¯Ø©ØŒ ÙˆÙƒØ§Ù† Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù…ØªÙ…ÙŠØ²Ù‹Ø§ ÙˆØ§Ù„ØªÙØ§Ø¹Ù„ ØµÙÙŠÙ‹Ø§ ÙˆÙ†Ø´Ø·Ù‹Ø§ØŒ ØªÙ„ØªÙ‡Ø§ Ù…Ø¯Ø§ÙˆÙ„Ø© Ø¥Ø´Ø±Ø§ÙÙŠØ© Ø¨Ù†Ù‘Ø§Ø¡Ø©.`;
                        }

                    } else if (opinionType === 'completed' && objectiveText === timetableObjectiveText) {
                        let summary = "ØªÙ…Øª Ù…ØªØ§Ø¨Ø¹Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠ ÙˆÙ†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµ Ù„Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†ØŒ ÙˆÙƒØ§Ù† Ø§Ù„ØªÙˆØ²ÙŠØ¹ ÙƒØ§Ù„ØªØ§Ù„ÙŠ:\n";
                        const teacherRows = opinionBlock.querySelectorAll('.teacher-timetable-row');
                        let detailsFound = false;
                        teacherRows.forEach(row => {
                            const teacherName = row.querySelector('.teacher-name-input').value;
                            const load = row.querySelector('.teacher-load-input').value;
                            const classes = row.querySelector('.teacher-classes-input').value;
                            if (teacherName || load || classes) {
                                detailsFound = true;
                                summary += `- ${teacherName || 'Ù…Ø¹Ù„Ù… ØºÙŠØ± Ù…Ø³Ù…Ù‰'}: Ù†ØµØ§Ø¨Ù‡ (${load || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}) Ø­ØµØ©ØŒ ÙˆÙŠØ¯Ø±Ø³ Ø§Ù„ØµÙÙˆÙ (${classes || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}).\n`;
                            }
                        });
                        if (detailsFound) {
                           summary += "ÙˆÙƒØ§Ù† Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ù…ØªÙˆØ§Ø²Ù†Ù‹Ø§ ÙˆØ¹Ø§Ø¯Ù„Ø§Ù‹ ÙˆÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©.";
                           textarea.value = summary;
                        } else {
                           textarea.value = visitTypesData[currentVisitTypeKey][`${opinionType}Opinions`][index];
                        }
                    } else {
                        const defaultOpinionText = visitTypesData[currentVisitTypeKey][`${opinionType}Opinions`][index];
                        textarea.value = defaultOpinionText || '';
                    }
                }

                if (e.target.matches('.add-teacher-btn')) {
                    const index = e.target.dataset.index;
                    const container = document.getElementById(`teacher-rows-container-${index}`);
                    const newRow = document.createElement('div');
                    newRow.className = 'grid grid-cols-4 gap-2 items-center teacher-timetable-row';
                    newRow.innerHTML = `
                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md teacher-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…">
                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md teacher-load-input" placeholder="Ù†ØµØ§Ø¨ Ø§Ù„Ø­ØµØµ">
                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md teacher-classes-input" placeholder="Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªÙŠ ÙŠØ¯Ø±Ø³Ù‡Ø§">
                        <button type="button" class="remove-teacher-btn text-red-500 hover:text-red-700 text-lg font-bold">Ã—</button>
                    `;
                    container.appendChild(newRow);
                }

                if (e.target.matches('.remove-teacher-btn')) {
                    e.target.closest('.teacher-timetable-row').remove();
                }

                if (e.target.matches('.add-session-btn')) {
                    const index = e.target.dataset.index;
                    const container = document.getElementById(`session-rows-container-${index}`);
                    const newRow = document.createElement('div');
                    newRow.className = 'grid grid-cols-4 gap-2 items-center session-row';
                    newRow.innerHTML = `
                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md lesson-number-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­ØµØ©">
                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md teacher-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…">
                        <input type="text" class="w-full text-sm p-1.5 border-gray-300 rounded-md class-name-input" placeholder="Ø§Ù„ØµÙ/Ø§Ù„Ø´Ø¹Ø¨Ø©">
                        <button type="button" class="remove-session-btn text-red-500 hover:text-red-700 text-lg font-bold">Ã—</button>
                    `;
                    container.appendChild(newRow);
                }

                if (e.target.matches('.remove-session-btn')) {
                    e.target.closest('.session-row').remove();
                }
            });

            // Local Recommendations Generator
            generateRecsBtn.addEventListener('click', () => {
                const checkedCheckboxes = objectivesContainer.querySelectorAll('input[type="checkbox"]:checked');
                if (checkedCheckboxes.length === 0) {
                    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù‡Ø¯Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
                    return;
                }
                const currentTypeData = visitTypesData[currentVisitTypeKey];
                let generatedRecommendations = [];
                checkedCheckboxes.forEach(checkbox => {
                    const index = checkbox.dataset.index;
                    const opinionTextarea = document.getElementById(`opinion-${index}`);
                    const incompleteOpinionText = currentTypeData.incompleteOpinions[index];
                    if (opinionTextarea && opinionTextarea.value.trim() === incompleteOpinionText.trim()) {
                        generatedRecommendations.push(currentTypeData.recommendations[index]);
                    }
                });
                if (generatedRecommendations.length > 0) {
                    recommendationsTextarea.value = "Ù†ÙˆØµÙŠ Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø¨Ø§Ù„Ø§ØªÙŠ :\n- " + generatedRecommendations.join('\n- ') + "\n\nÙˆØ§Ù„Ù„Ù‡ Ø§Ù„Ù…ÙˆÙÙ‚.";
                } else {
                    recommendationsTextarea.value = "Ø³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ Ù…Ù…ØªØ§Ø² ÙˆÙ„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ø¬Ø© Ù„ØªÙˆØµÙŠØ§Øª Ø­Ø§Ù„ÙŠØ©.";
                }
            });

            // --- MODAL LOGIC (Unchanged from previous version) ---
            manageVisitTypesBtn.addEventListener('click', () => {
                renderManagerModal();
                manageTypesModal.classList.remove('hidden');
            });
            closeManageModalBtn.addEventListener('click', () => manageTypesModal.classList.add('hidden'));
            addNewTypeBtn.addEventListener('click', () => {
                editTypeKey.value = '';
                addEditModalTitle.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯';
                addEditTypeForm.reset();
                addEditTypeModal.classList.remove('hidden');
            });
            visitTypesList.addEventListener('click', (e) => {
                const key = e.target.dataset.key;
                if (!key) return;
                if (e.target.classList.contains('edit-btn')) {
                    editTypeKey.value = key;
                    addEditModalTitle.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø©';
                    typeName.value = visitTypesData[key].name;
                    typeObjectives.value = visitTypesData[key].objectives.join('\n');
                    addEditTypeModal.classList.remove('hidden');
                }
                if (e.target.classList.contains('delete-btn')) {
                    if (Object.keys(visitTypesData).length <= 1) { return alert("ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù†ÙˆØ¹ Ø²ÙŠØ§Ø±Ø© ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„."); }
                    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù "${visitTypesData[key].name}"ØŸ`)) {
                        delete visitTypesData[key];
                        saveVisitTypes();
                        loadData();
                        populateVisitTypeDropdown();
                        renderObjectivesForCurrentType();
                        renderManagerModal();
                    }
                }
            });
            cancelEditBtn.addEventListener('click', () => addEditTypeModal.classList.add('hidden'));
            addEditTypeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const key = editTypeKey.value;
                const name = typeName.value.trim();
                const objectives = typeObjectives.value.trim().split('\n').filter(line => line.trim() !== '');
                if (!name || objectives.length === 0) { return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆÙ†ÙˆØ¹ ÙˆÙ‡Ø¯Ù ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„."); }
                const newKey = key || `type_${Date.now()}`;
                const { completedOpinions, incompleteOpinions, recommendations } = generateOpinionsAndRecommendations(objectives);
                visitTypesData[newKey] = { name, objectives, completedOpinions, incompleteOpinions, recommendations };
                saveVisitTypes();
                currentVisitTypeKey = newKey;
                populateVisitTypeDropdown();
                renderObjectivesForCurrentType();
                renderManagerModal();
                addEditTypeModal.classList.add('hidden');
            });
            function renderManagerModal() {
                visitTypesList.innerHTML = '';
                 Object.keys(visitTypesData).forEach(key => {
                    const type = visitTypesData[key];
                    const item = document.createElement('div');
                    item.className = 'flex justify-between items-center p-2 bg-gray-50 rounded-lg';
                    item.innerHTML = `
                        <span class="font-medium">${type.name}</span>
                        <div class="flex gap-2">
                            <button data-key="${key}" class="edit-btn text-sm text-blue-600 hover:underline">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button data-key="${key}" class="delete-btn text-sm text-red-600 hover:underline">Ø­Ø°Ù</button>
                        </div>
                    `;
                    visitTypesList.appendChild(item);
                });
            }

            // --- INITIALIZE APP ---
            function initializeApp() {
                loadData();
                populateVisitTypeDropdown();
                renderObjectivesForCurrentType();
                showDashboardView();
            }
            initializeApp();
        });
    </script>

</body>
</html>

